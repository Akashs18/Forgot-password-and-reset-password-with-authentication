<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Store Dashboard</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,Segoe UI}
body{background:#f9fafb}
.container{display:flex;min-height:100vh}

/* Sidebar */
.sidebar{
  width:260px;
  background:linear-gradient(180deg,#1e293b,#0f172a);
  color:#fff;
  padding:20px;
}
.menu{list-style:none}
.menu-item{
  padding:14px;
  border-radius:10px;
  cursor:pointer;
  margin-bottom:8px;
  display:flex;
  gap:12px;
  align-items:center;
}
.menu-item.active,.menu-item:hover{
  background:rgba(255,255,255,.12);
}

/* Main */
.main-content{flex:1;padding:35px}
.tab-content{display:none;background:#fff;border-radius:14px;padding:25px}
.tab-content.active{display:block}

/* Forms */
.form-group{margin-bottom:18px}
label{font-size:14px;font-weight:500}
.form-control{
  width:100%;
  padding:10px;
  border:1px solid #d1d5db;
  border-radius:8px;
}

/* Button */
.btn{
  background:#2563eb;
  color:#fff;
  border:none;
  padding:10px 22px;
  border-radius:25px;
  cursor:pointer;
}

/* Local Purchase */
/* Local Purchase - Enhanced Design */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: #ffffff;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  border-radius: 10px;
  overflow: hidden;
  font-size: 14px;
}

thead {
  background: linear-gradient(90deg, #2563eb, #3b82f6);
  color: #fff;
}

th, td {
  border: 1px solid #e5e7eb;
  padding: 12px 15px;
  text-align: left;
}

th {
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

tbody tr:nth-child(even) {
  background: #f9fafb;
}

tbody tr:hover {
  background: #e0f2fe;
  transition: background 0.3s ease;
}

td input {
  width: 100%;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  padding: 6px 8px;
  font-size: 14px;
}

td button {
  padding: 6px 10px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-size: 13px;
  transition: all 0.2s ease;
}

td button:hover {
  opacity: 0.8;
}

table caption {
  caption-side: top;
  font-weight: 600;
  font-size: 16px;
  margin-bottom: 10px;
  color: #1e293b;
}



/* Popup */
.popup-overlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.5);
  display:flex;align-items:center;justify-content:center;
}



</style>
</head>

<body>

<div class="container">

<!-- SIDEBAR -->
<div class="sidebar">
  <ul class="menu">
    <li class="menu-item active" onclick="switchTab('store',event)">
      <i class="fas fa-warehouse"></i> Store Management
    </li>
    <li class="menu-item" onclick="switchTab('local',event)">
      <i class="fas fa-shopping-cart"></i> Local Purchase
    </li>
    <li class="menu-item">
      <form action="/logout" method="POST">
        <button class="btn" style="background:none">Logout</button>
      </form>
    </li>
  </ul>
</div>

<!-- MAIN -->
<div class="main-content">





 <div class="tab-content active" id="store">
        <div class="tab-header">
          <h3>Store Management Entry</h3>
          <p>Enter inventory details for store management</p>
        </div>

        <form action="/submit-inventory" method="post" enctype="multipart/form-data">
          <input type="hidden" name="management-type" value="store">
          <div class="form-group">
            <label for="order_id_store">Select Purchase Order</label>
            <select id="order_id_store" name="order_id" class="form-control" required>
              <option value="">Select an order</option>
            </select>
          </div>

          <div class="form-group">
            <label for="grn_store">GRN Number</label>
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="text" id="grn_store" name="grn" class="form-control" placeholder="Enter GRN number" required>
              <button type="button" id="generate-grn-btn" class="btn" style="padding: 10px 16px; font-size: 14px; white-space: nowrap;">
                <i class="fas fa-magic"></i> Generate GRN
              </button>
            </div>
          </div>

          <div class="form-group">
            <label for="invoice_store">Upload Invoice</label>
            <input type="file" id="invoice_store" name="invoice" class="form-control" accept=".pdf,.jpg,.png,.jpeg" required>
          </div>


         <!-- Supplier Bank Details Section-->
          

      <!-- Bank Details -->
      <div class="bank-box">
        <h4>Supplier Bank Details</h4>

        <div class="store-grid">
          <div class="form-group">
            <label>Account Number</label>
            <input type="text" name="supplier_account_number" class="form-control">
          </div>

          <div class="form-group">
            <label>Account Name</label>
            <input type="text" name="supplier_account_name" class="form-control">
          </div>

          <div class="form-group">
            <label>IFSC Code</label>
            <input type="text" name="supplier_ifsc_code" class="form-control">
          </div>

          <div class="form-group">
            <label>Amount</label>
            <input type="number" step="0.01" name="amount" class="form-control">
          </div>

          <div class="form-group full-width">
            <label>Shift Code (Optional)</label>
            <input type="text" name="shift_code" class="form-control">
          </div>
        </div>
      </div>

      <div class="store-submit">
        <button type="submit" class="btn">
          <i class="fas fa-paper-plane"></i> Submit Store Entry
        </button>
      </div>

     </form>
   </div>
 






 <!-- LOCAL PURCHASE -->
 <div class="tab-content" id="local"> 
  <h1>Local Purchase Entry</h1><br>

  <button class="btn" onclick="addRow()">‚ûï Add Row</button>
  <button class="btn" onclick="saveAll()">üíæ Save</button>

  <table id="purchaseTable">
    <thead>
      <tr>
        <th>Item</th>
        <th>Vendor</th>
        <th>Qty</th>
        <th>Price</th>
        <th>Date</th>
        <th>Bill</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
   </table>
  </div>
 </div> 
</div>



<script>
/* TAB SWITCH */
function switchTab(tab, event){
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.getElementById(tab).classList.add('active');

  document.querySelectorAll('.menu-item').forEach(m=>m.classList.remove('active'));
  event.currentTarget.classList.add('active');
}

/* STORE */
async function generateGRN(){
  document.getElementById('grn_store').value="GRN-"+Date.now();
}

/* LOCAL PURCHASE */
async function loadPurchases(){
  const res=await fetch("/local-purchase");
  const data=await res.json();
  const tbody=document.querySelector("#purchaseTable tbody");
  tbody.innerHTML="";
  data.forEach(p=>{
    const r=tbody.insertRow();
    r.innerHTML=`
      <td contenteditable>${p.item}</td>
      <td contenteditable>${p.vendor}</td>
      <td contenteditable>${p.quantity}</td>
      <td contenteditable>${p.price}</td>
      <td contenteditable>${p.purchase_date.slice(0,10)}</td>
      <td>${p.bill_file?`<a href="${p.bill_file}" target="_blank">View</a>`:""}</td>
      <td>
        <button onclick="updateRow(${p.id},this)">‚úèÔ∏è</button>
        <button onclick="deleteRow(${p.id})">üóëÔ∏è</button>
      </td>`;
  })
}

function addRow(){
  const r=document.querySelector("#purchaseTable tbody").insertRow();
  r.innerHTML=`
    <td><input></td>
    <td><input></td>
    <td><input type="number"></td>
    <td><input type="number"></td>
    <td><input type="date"></td>
    <td><input type="file"></td>
    <td>New</td>`;
}

async function saveAll(){
  const rows=document.querySelectorAll("#purchaseTable tbody tr");
  for(let r of rows){
    if(r.cells[6].innerText==="New"){
      const f=new FormData();
      f.append("item",r.cells[0].querySelector("input").value);
      f.append("vendor",r.cells[1].querySelector("input").value);
      f.append("quantity",r.cells[2].querySelector("input").value);
      f.append("price",r.cells[3].querySelector("input").value);
      f.append("date",r.cells[4].querySelector("input").value);
      f.append("bill",r.cells[5].querySelector("input").files[0]);
      await fetch("/local-purchase",{method:"POST",body:f});
    }
  }
  loadPurchases();
}

async function deleteRow(id){
  await fetch(`/local-purchase/${id}`,{method:"DELETE"});
  loadPurchases();
}

async function updateRow(id,btn){
  const r=btn.closest("tr");
  await fetch(`/local-purchase/${id}`,{
    method:"PUT",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      item:r.cells[0].innerText,
      vendor:r.cells[1].innerText,
      quantity:r.cells[2].innerText,
      price:r.cells[3].innerText,
      date:r.cells[4].innerText
    })
  });
  alert("Updated");
}

loadPurchases();
</script>

</body>
</html>
